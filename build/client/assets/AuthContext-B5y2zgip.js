import{r,a as y,j as v}from"./components-B3s0IpTW.js";import{h}from"./Lib-DgMjv0aD.js";const g=r.createContext(null),p="https://gursse.com";function b(){const i=r.useContext(g);if(!i)throw new Error("useAuth must be used within an AuthProvider");return i}function J({children:i}){let[E,a]=r.useState(null),[w,u]=r.useState(null);const m=async s=>{try{let t=p+"/api/users/verifytoken";const e=await fetch(t,{method:"POST",headers:h,body:JSON.stringify({token:s})});if(e.status!==200)throw new Error("Could not obtain token");return await e.json()}catch(n){return console.log(n.message),alert(n.message),null}};r.useEffect(()=>{const s=localStorage.getItem("authTokens");if(s!==null){const e=JSON.parse(s);a(e)}else a(null);if(s){const l=JSON.parse(s).accessToken;m(l).then(o=>{o===null?(a(null),u(null),localStorage.removeItem("authTokens")):u(o)})}else u(null);T(!1);let n=1e3*60*60*12,t=setInterval(()=>{d()},n);return()=>clearInterval(t)},[]);let[P,T]=r.useState(!0);const f=p+"/api/users/signin";y(),alert(f);let S=async s=>{try{const n=await fetch(f,{method:"POST",headers:h,body:JSON.stringify(s)});let t=await n.json();return n.status===200?(a(t),m(t.accessToken).then(e=>{u(e)}),localStorage.setItem("authTokens",JSON.stringify(t)),new Promise(e=>{setTimeout(()=>{e(!0)},100)})):new Promise(e=>{setTimeout(()=>{e(t)},100)})}catch{return new Promise(t=>{setTimeout(()=>{t(!1)},100)})}};const d=()=>{a(null),u(null),localStorage.removeItem("authTokens"),window.location.reload()};let k={user:w,signin:S,signout:d,resetpw:async s=>{const e="https://gursse.com"+"/api/users/reset_password_request";try{const o=await fetch(e,{method:"POST",headers:h,body:JSON.stringify(s)});var l=await o.json();if(o.ok)return new Promise(c=>{setTimeout(()=>{c(l.message)},100)});throw new Error(`Error Code: ${o.status} - ${l.message}`)}catch(o){return new Promise(c=>{setTimeout(()=>{c(o.message)},100)})}finally{}}};return v.jsx(g.Provider,{value:k,children:i})}export{J as A,b as u};
