import{r as h,j as e,b as y}from"./components-B3s0IpTW.js";import{P as v}from"./ProfileLayout-CiPTMqaQ.js";import{z as o,u as N,s as S}from"./index-DAH1x-Px.js";import{I as m,B as _}from"./Button-P7evaT8k.js";import{h as C}from"./Lib-NIWUsXcU.js";import{u as E}from"./AuthContext-CTVYchcJ.js";import"./Footer-ByimyL7f.js";import"./MobileNav-BsYC7GnI.js";import"./iconBase-Bk1nv4PK.js";import"./index-CIOWmsy1.js";import"./index-CDpADjvc.js";import"./index-CB7nKGqz.js";const c=new RegExp(/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!()Â£@$%^&*-]).{8,}$/),T=o.object({oldpassword:o.string().min(1,{message:"Please enter old password."}).min(8,{message:"Password must be up to 8 characters."}).regex(c,{message:"Please enter a valid password"}),newpassword:o.string().min(1,{message:"Please enter new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(c,{message:"Please enter a valid password"}),newpassword2:o.string().min(1,{message:"Please retype new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(c,{message:"Please enter a valid password"})}).superRefine((s,a)=>{s.oldpassword===s.newpassword&&a.addIssue({code:o.ZodIssueCode.custom,path:["newpassword"],message:"New password cannot be the same as old password"}),s.newpassword!==s.newpassword2&&a.addIssue({code:o.ZodIssueCode.custom,path:["newpd2"],message:"Your new password don't match"})}),I=({loaderData:s,user:a})=>{var g;const[R,f]=h.useState(null),[P,u]=h.useState(!1),n=r=>{let w=r.target.value,i=r.target.name;f(p=>({...p,[i]:w}))},x=async r=>{u(!0),await new Promise(t=>setTimeout(t,1e3));const w="http://gursse.com",i="/api/users/change_password/"+s.userProfileData.user_guid,p=w+i;r.password=r.newpassword,delete r.oldpassword,delete r.newpassword,delete r.newpassword2;try{const t=await fetch(p,{method:"PUT",headers:C,body:JSON.stringify(r)});if(t.ok)alert("Password Successfully Changed! Use new password on next login");else{let L=t.json().then(j=>{alert(j.error)})}}catch{return}finally{u(!1)}},{register:d,handleSubmit:b,getValues:V,setValue:k,watch:A,setError:B,formState:{errors:l,isSubmitting:F}}=N({defaultValues:s.listing,resolver:S(T)});return e.jsx("form",{onSubmit:b(x),children:e.jsxs("div",{className:"form__wrapper__class",children:[e.jsxs("div",{className:"input__wrapper_class",children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Change Password"}),e.jsxs("div",{className:" pt-3 text-[15px] leading-5",children:[e.jsx("b",{children:(g=s.userProfileData)==null?void 0:g.email})," is your current email. It will be used be used for password resets or changes."]})]}),e.jsx(m,{controlTitle:"Current Password",controlPlaceholder:"Enter current password",controlType:"password",controlName:"oldpassword",register:d,changeHandler:n,error:l.oldpassword}),e.jsx(m,{controlTitle:"New Password",controlType:"password",controlPlaceholder:"Enter new password",controlName:"newpassword",register:d,changeHandler:n,error:l.newpassword}),e.jsx(m,{controlTitle:"Retype New Password",controlPlaceholder:"Retype new password",controlName:"newpassword2",controlType:"password",register:d,changeHandler:n,error:l.newpassword2}),e.jsx(_,{working:P})]})})},K=()=>{const s=y(),{user:a}=E();return e.jsx(v,{title:"Change Password",children:s&&e.jsx(I,{loaderData:s,user:a})})};export{K as default};
