import{j as e,r as c,b as Z}from"./components-B3s0IpTW.js";import{P as k}from"./ProfileLayout-wnHXAsjo.js";import{z as t,u as V,s as H}from"./index-DAH1x-Px.js";import{a as M,b as O,h as U}from"./Lib-DgMjv0aD.js";import{I as m,B as Y}from"./Button-P7evaT8k.js";import{S as p}from"./Select-DE8yix5g.js";import{M as $}from"./index-CB7nKGqz.js";import{u as W}from"./AuthContext-8FHLzqeM.js";import"./Footer-CYY9kVHS.js";import"./MobileNav-BsYC7GnI.js";import"./iconBase-Bk1nv4PK.js";import"./index-CIOWmsy1.js";import"./index-CDpADjvc.js";const q=t.object({title:t.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),category:t.string().min(1,{message:"Please select a business category."}),country_code:t.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),state_code:t.any(),city_id:t.any(),zipcode:t.string().min(1,{message:"Zipcode must not be empty"}).max(7,{message:"Zipcode must not be more than 7 characters"}),short_description:t.string({message:"Please enter business phrase"}).min(3,{message:"Short Description must not be less than 3 characters"}).max(1e3,{message:"Short Description must not be more than 1000 characters"}),email_address:t.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),phone:t.string().min(1,{message:"Phone must not be empty"}).max(30,{message:"PHone must not be more than 30 characters"}),address_one:t.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),address_two:t.any(),established:t.string({message:"Please enter year established"}).min(4,{message:"Year must be at least 4 characters"})}).superRefine((s,i)=>{var h,d;((h=s==null?void 0:s.address_two)==null?void 0:h.length)!==0&&((d=s==null?void 0:s.address_two)==null?void 0:d.length)<3&&i.addIssue({code:t.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),G=({controlName:s,controlPlaceholder:i,controlTitle:h,register:d,changeHandler:_,error:g})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"textarea__wrapper_class",children:[e.jsx("div",{className:"input__heading__class",children:h}),e.jsxs("div",{children:[e.jsx("textarea",{...d(s,{onChange:_}),className:"textarea__class",placeholder:i}),g&&e.jsxs("div",{className:"input__class__error -mt-[5px]",children:[e.jsx($,{className:"text-lg"}),g.message]})]})]})}),K=({loaderData:s,user:i})=>{const[h,d]=c.useState(null),[_,g]=c.useState(!1),P=s.countries;let[w,N]=c.useState(s.states),[E,C]=c.useState(s.cities);const T=s.categories.data,[A,B]=c.useState(s.listing.country_code),[Q,v]=c.useState(s.listing.state_code),[S,z]=c.useState(""),[b,J]=c.useState(""),F=async r=>{B(r),z(r);const u=await M(r);N(u),f("")},f=async r=>{v(r),J(r);const u=await O(A,r);C(u)},o=r=>{let u=r.target.value,j=r.target.name;d(y=>({...y,[j]:u}))},I=async r=>{g(!0),await new Promise(l=>setTimeout(l,1e3)),r.owner=i.guid;const y="https://gursse.com"+"/api/listings";try{const l=await fetch(y,{method:"POST",headers:U,body:JSON.stringify(r)});if(l.ok)alert("Successfully added!");else{var R=await l.json();throw new Error(`Error Code: ${l.status} - ${R.error}`)}}catch(l){alert(l.message);return}finally{g(!1)}},{register:a,handleSubmit:L,getValues:X,watch:D,setValue:x,setError:ee,formState:{errors:n,isSubmitting:se}}=V({defaultValues:s.listing,resolver:H(q)});return c.useEffect(()=>{S&&(x("state_code",""),x("city_id",""))},[S]),c.useEffect(()=>{b&&x("city_id","")},[b]),e.jsx("form",{onSubmit:L(I),children:e.jsxs("div",{className:"form__wrapper__class",children:[e.jsx(m,{controlTitle:"Business Name",controlPlaceholder:"Enter business name",controlName:"title",register:a,changeHandler:o,error:n.title,width:80}),e.jsx(m,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:a,changeHandler:o,error:n.email_address}),e.jsx(p,{controlTitle:"Business Category",controlName:"category",controlPlaceholder:"Select business category",selectJson:T,register:a,changeHandler:o,error:n.category}),e.jsx(m,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:a,changeHandler:o,error:n.established}),e.jsx(p,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:P,register:a,changeHandler:o,error:n.country_code,setCode:F}),e.jsx(p,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:w,register:a,changeHandler:o,error:n.state_code,setCode:f}),e.jsx(p,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:E,register:a,changeHandler:o,error:n.city_id}),e.jsx(m,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:a,changeHandler:o,error:n.address_one,width:100}),e.jsx(m,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:a,changeHandler:o,error:n.address_two,width:100}),e.jsx(m,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:a,changeHandler:o,error:n.zipcode}),e.jsx(m,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:a,changeHandler:o,error:n.phone}),e.jsx(G,{controlTitle:"Description",controlPlaceholder:"Shotrt description",controlName:"short_description",register:a,changeHandler:o,error:n.short_description}),e.jsx(Y,{working:_})]})})},pe=()=>{const s=Z(),{user:i}=W();return console.log(i),e.jsx(k,{title:"Add Business",children:s&&e.jsx(K,{loaderData:s,user:i})})};export{pe as default};
