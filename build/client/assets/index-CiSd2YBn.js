import{r as t,j as e,b as D}from"./components-B3s0IpTW.js";import{P as J}from"./ProfileLayout-wnHXAsjo.js";import{z as o,u as O,s as W}from"./index-DAH1x-Px.js";import{I as g,B as G}from"./Button-P7evaT8k.js";import{S as R}from"./Select-DE8yix5g.js";import{a as V,b as $,h as q,c as H}from"./Lib-DgMjv0aD.js";import{a as K}from"./index-CB7nKGqz.js";import{u as Z}from"./NotificationContext-7wGW9xfz.js";import{u as Q}from"./AuthContext-8FHLzqeM.js";import"./Footer-CYY9kVHS.js";import"./MobileNav-BsYC7GnI.js";import"./iconBase-Bk1nv4PK.js";import"./index-CIOWmsy1.js";import"./index-CDpADjvc.js";const X=o.object({first_name:o.string().min(1,{message:"Enter a first name"}),lastname:o.any(),country_code:o.any(),state_code:o.any(),city_id:o.any(),phone:o.any(),address_one:o.any(),address_two:o.any(),country:o.any(),xsocial:o.any(),linksocial:o.any(),fbsocial:o.any(),zipcode:o.any()}),Y=({user:a,userProfileImageData:s})=>{const i="https://oxbyt.com",d=Z();let f="";s.image_url?f=i+s.image_url:f="https://trendyblinds.ca/wp-content/uploads/2023/09/3.-3D-WALLPAPER-SKU0015.jpg";const[b,P]=t.useState(f),[w,N]=t.useState(null),j=t.useRef(null),[C,v]=t.useState(!1),[x,y]=t.useState(!1),E=()=>{var r;(r=j.current)==null||r.click()},F=r=>{var h;const p=(h=r.target.files)==null?void 0:h[0];if(p){const _=URL.createObjectURL(p);P(_),N(p),v(!0)}},U=async()=>{if(y(!0),d.notify("Working..."),await new Promise(r=>setTimeout(r,1e3)),C){const r=new FormData;r.append("file",w),r.append("guid",a.user_guid);const _="https://oxbyt.com"+"/user_profile_pic_upload";try{const S=await fetch(_,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:r});if(S.ok)d.alertReload("","Image uploaded successfully!");else{let I=S.json().then(l=>{d.alertCancel("",l.message)})}}catch{return}finally{y(!1)}}else d.alertCancel("","Please select an image to continue."),y(!1)};return e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-blue-100 w-[150px] h-[150px] z-40 rounded-full overflow-hidden",children:[e.jsx("img",{src:b,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}),e.jsx("input",{type:"file",accept:"image/*",ref:j,className:" hidden",onChange:F}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 top-0 object-cover
                                 text-white/80 `,onMouseDown:E,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out`,children:e.jsx(K,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`${x?"bg-gray-200 cursor-default":"bg-blue-100"}  w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:U,disabled:x,children:x?"Uploading...":"Upload"})})]})},ee=({loaderData:a,user:s,userProfileData:i,userProfileImageData:d})=>{const[f,b]=t.useState(null),[P,w]=t.useState(!1),N=a.countries;let[j,C]=t.useState(a.states),[v,x]=t.useState(a.cities);a.categories.data;const[y,E]=t.useState(a.userProfileData.country_code),[F,U]=t.useState(a.userProfileData.state_code),[r,p]=t.useState(""),[h,_]=t.useState(""),S=async n=>{E(n),p(n);const u=await V(n);C(u),I("")},I=async n=>{U(n),_(n);const u=await $(y,n);x(u)},l=n=>{let u=n.target.value,T=n.target.name;b(k=>({...k,[T]:u}))},z=async n=>{w(!0),await new Promise(m=>setTimeout(m,1e3));const u="https://gursse.com",T="/api/users/"+s.guid,k=u+T;try{const m=await fetch(k,{method:"PUT",headers:q,body:JSON.stringify(n)});if(m.ok)alert("Update is Successfully!");else{var B=await m.json();throw new Error(`Error Code: ${m.status} - ${B.error}`)}}catch(m){alert(m.message);return}finally{w(!1)}},{register:c,handleSubmit:M,getValues:te,setValue:A,watch:se,setError:oe,formState:{errors:L,isSubmitting:re}}=O({defaultValues:i,resolver:W(X)});return t.useEffect(()=>{r&&(A("state_code",""),A("city_id",""))},[r]),t.useEffect(()=>{h&&A("city_id","")},[h]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"form__wrapper__class",children:e.jsxs("div",{className:"input__wrapper_class flex flex-col place-items-center md:place-items-start",children:[e.jsx("div",{className:"input__heading__class",children:"Add/Change Photo"}),e.jsx("div",{className:"mt-4",children:e.jsx(Y,{user:i,userProfileImageData:a.userProfileImageData})})]})}),e.jsx("form",{onSubmit:M(z),children:e.jsxs("div",{className:"form__wrapper__class -mt-0",children:[e.jsx(g,{controlTitle:"First Name",controlName:"first_name",controlPlaceholder:"Enter first name",register:c,changeHandler:l,error:L.first_name}),e.jsx(g,{controlTitle:"Last Name",controlName:"lastname",controlPlaceholder:"Enter last name",register:c,changeHandler:l,error:L.lastname}),e.jsx(R,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select Country",selectJson:N,register:c,changeHandler:l,error:L.country_code,setCode:S}),e.jsx(R,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select State",selectJson:j,register:c,changeHandler:l,setCode:I}),e.jsx(R,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select City",selectJson:v,register:c,changeHandler:l}),e.jsx(g,{controlTitle:"Zipcode",controlName:"zipcode",controlPlaceholder:"Enter zip code",register:c,changeHandler:l}),e.jsx(g,{controlTitle:"Phone",controlName:"phone",controlPlaceholder:"Enter phone number",register:c,changeHandler:l}),e.jsx(g,{controlTitle:"Address Line 1",controlName:"address_one",controlPlaceholder:"Enter address",register:c,changeHandler:l}),e.jsx(g,{controlTitle:"Address Line 2",controlName:"address_two",controlPlaceholder:"Enter address",register:c,changeHandler:l}),e.jsx(G,{working:P})]})})]})},_e=()=>{const a=D(),{user:s}=Q(),[i,d]=t.useState(void 0);return t.useEffect(()=>{s!=null&&s.guid&&H(s==null?void 0:s.guid).then(f=>{d(f)})},[s==null?void 0:s.guid]),e.jsx(J,{title:"Profile",children:a&&s&&i&&e.jsx(ee,{loaderData:a,user:s,userProfileData:i})})};export{_e as default};
