import{r as l,j as e,b as D}from"./components-B3s0IpTW.js";import{P as Y}from"./ProfileLayout-BmGu60BQ.js";import{B as J}from"./BusinessMenu-Dy3rzcrD.js";import{z as t,u as G,s as K}from"./index-DAH1x-Px.js";import{I as d,B as O}from"./Button-P7evaT8k.js";import{S as A}from"./Select-DE8yix5g.js";import{a as V,b as Z,h as q}from"./Lib-DgMjv0aD.js";import{a as H,M as $}from"./index-CB7nKGqz.js";import{u as Q}from"./NotificationContext-7wGW9xfz.js";import"./AuthContext-8FHLzqeM.js";import"./Footer-B-5aMnpr.js";import"./MobileNav-ChBINXPn.js";import"./iconBase-Bk1nv4PK.js";import"./index-CIOWmsy1.js";import"./index-CDpADjvc.js";const X=t.object({username:t.any(),title:t.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),country_code:t.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),address_one:t.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),short_description:t.string().refine(s=>s.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(s=>s.trim().split(/\s+/).filter(Boolean).length<=50,{message:"You can only write up to 50 words."}),long_description:t.string().refine(s=>s.trim().split(/\s+/).filter(Boolean).length>=100,{message:"You must write at least 100 words."}).refine(s=>s.trim().split(/\s+/).filter(Boolean).length<=500,{message:"You can only write up to 500 words."}),address_two:t.any(),state_code:t.any(),state_text:t.any(),country_text:t.any(),city_id:t.any(),established:t.string({message:"Please enter year established"}).min(4,{message:"Year must be at least 4 characters"}),call_code:t.any(),phone:t.any(),zipcode:t.any(),intro:t.any(),category:t.string().min(2,{message:"Please select a business category"}),business_phrases:t.union([t.literal(""),t.string({message:"Please enter business phrase"}).min(3,{message:"Business Phrases must not be less than 3 characters"}).max(1e3,{message:"Business Phrases must not be more than 100 characters"}).nullish()]),products:t.any(),services:t.any(),xsocial:t.any(),fbsocial:t.any(),linksocial:t.any(),website:t.union([t.string().url().nullish(),t.literal("")])}).superRefine((s,i)=>{var u,h;((u=s==null?void 0:s.address_two)==null?void 0:u.length)!==0&&((h=s==null?void 0:s.address_two)==null?void 0:h.length)<3&&i.addIssue({code:t.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),ee=({listing:s,user:i,businessProfileImageData:u})=>{const h="https://oxbyt.com";let y="";u.image_url?y=h+u.image_url:y="https://trendyblinds.ca/wp-content/uploads/2023/09/3.-3D-WALLPAPER-SKU0015.jpg";const[_,j]=l.useState(y),[N,v]=l.useState(null),C=l.useRef(null),[w,T]=l.useState(!1),[x,S]=l.useState(!1),g=Q(),E=()=>{var c;(c=C.current)==null||c.click()},P=c=>{var p;const r=(p=c.target.files)==null?void 0:p[0];if(r){const f=URL.createObjectURL(r);j(f),v(r),T(!0)}},B=async()=>{if(S(!0),g.notify("Working..."),await new Promise(c=>setTimeout(c,1e3)),w){const c=new FormData;c.append("file",N),c.append("guid",i.user_guid),c.append("bid",s.gid);const f="https://oxbyt.com"+"/business_profile_pic_upload";try{const o=await fetch(f,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:c});if(o.ok)g.alertReload("","Image uploaded successfully!");else{let U=o.json().then(n=>{g.alertCancel("",n.message)})}}catch{return}finally{S(!1)}}else g.alertCancel("","Please select an image to continue."),S(!1)};return e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-blue-100 w-[150px] h-[150px] z-40 rounded-full overflow-hidden",children:[e.jsx("img",{src:_,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}),e.jsx("input",{type:"file",accept:"image/*",ref:C,className:" hidden",onChange:P}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 top-0 object-cover
                                 text-white/80 `,onMouseDown:E,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out`,children:e.jsx(H,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`${x?"bg-gray-200 cursor-default":"bg-blue-100"}  w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:B,disabled:x,children:x?"Uploading...":"Upload"})})]})},W=({controlName:s,controlPlaceholder:i,controlTitle:u,register:h,changeHandler:y,error:_,setValue:j,getValues:N,watch:v,minWords:C=100,maxWords:w=500})=>{const[T,x]=l.useState(""),[S,g]=l.useState(!1),E=r=>(r==null?void 0:r.trim())===""?0:r==null?void 0:r.trim().split(/\s+/).length,P=r=>{const p=r.target.value,f=p.trim().split(/\s+/);if(f.length<=w)j("text",p),g(!1);else{g(!0);const o=f.slice(0,w).join(" ");j("text",o)}},B=v("text")||"",c=r=>{B.trim().split(/\s+/).length>=w&&r.key!=="Backspace"&&r.key!=="Delete"&&!r.ctrlKey?(r.preventDefault(),g(!0)):g(!1)};return l.useEffect(()=>{if(s){let r=N(s);x(r)}},[s]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"textarea__wrapper_class",children:[e.jsxs("div",{className:"flex place-content-between",children:[e.jsx("label",{className:"block mb-1 text-md font-semibold",children:u}),e.jsxs("label",{className:" text-gray-600 text-sm",children:["Word Count: ",e.jsx("strong",{children:E(T)})]})]}),e.jsxs("div",{children:[e.jsx("textarea",{...h(s,{onChange:r=>{x(r.target.value),P(r),y(r)}}),className:"textarea__class",placeholder:i,onKeyDown:c}),_&&e.jsxs("div",{className:"input__class__error -mt-[5px]",children:[e.jsx($,{className:"text-lg"}),_.message]})]})]})})},se=({loaderData:s,userProfileData:i})=>{const[u,h]=l.useState(null),[y,_]=l.useState(!1),j=s.countries;let[N,v]=l.useState(s.states),[C,w]=l.useState(s.cities);const T=s.categories.data,[x,S]=l.useState(s.listing.country_code),[g,E]=l.useState(s.listing.state_code),[P,B]=l.useState(""),[c,r]=l.useState(""),p=async m=>{S(m),B(m);const b=await V(m);v(b),f("")},f=async m=>{E(m),r(m);const b=await Z(x,m);w(b)},o=m=>{let b=m.target.value,I=m.target.name;h(L=>({...L,[I]:b}))},U=async m=>{_(!0),await new Promise(R=>setTimeout(R,1e3));const b="https://gursse.com",I="/api/listings/"+s.listing.gid,L=b+I;try{(await fetch(L,{method:"PUT",headers:q,body:JSON.stringify(m)})).ok?alert("Successfully updated!"):alert("Could not update. Try again!")}catch{return}finally{_(!1)}},{register:n,handleSubmit:z,getValues:F,setValue:k,watch:M,setError:te,formState:{errors:a,isSubmitting:re}}=G({defaultValues:s.listing,resolver:K(X)});return l.useEffect(()=>{P&&(k("state_code",""),k("city_id",""))},[P,s]),l.useEffect(()=>{c&&k("city_id","")},[c]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"form__wrapper__class",children:e.jsxs("div",{className:"input__wrapper_class flex flex-col place-items-center md:place-items-start",children:[e.jsx("div",{className:"input__heading__class",children:"Add/Change Photo"}),e.jsx("div",{className:"mt-4",children:e.jsx(ee,{listing:s.listing,user:i,businessProfileImageData:s.businessProfileImageData})})]})}),e.jsx("form",{onSubmit:z(U),children:e.jsxs("div",{className:"form__wrapper__class",children:[e.jsx(d,{controlTitle:"Username",controlPlaceholder:"Enter username",controlName:"username",register:n,changeHandler:o,error:a.username}),e.jsx(d,{controlTitle:"Business name",controlPlaceholder:"Enter business name",controlName:"title",register:n,changeHandler:o,error:a.title}),e.jsx(d,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:n,changeHandler:o,error:a.established}),e.jsx(A,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:j,register:n,changeHandler:o,error:a.country_code,setCode:p}),e.jsx(A,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:N,register:n,changeHandler:o,error:a.state_code,setCode:f}),e.jsx(A,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:C,register:n,changeHandler:o,error:a.city_id}),e.jsx(d,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:n,changeHandler:o,error:a.address_one,width:100}),e.jsx(d,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:n,changeHandler:o,error:a.address_two,width:100}),e.jsx(d,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:n,changeHandler:o,error:a.zipcode}),e.jsx(d,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:n,changeHandler:o,error:a.phone}),e.jsx(A,{controlTitle:"Category",controlName:"category",controlPlaceholder:"Select category",selectJson:T,register:n,changeHandler:o,error:a.category}),e.jsx(d,{controlTitle:"Business Phrases",controlPlaceholder:"E.g. Advocates, Software Developers, Architect",controlName:"business_phrases",register:n,changeHandler:o,error:a.business_phrases}),e.jsx(d,{controlTitle:"Products",controlPlaceholder:"Enter products",controlName:"products",register:n,changeHandler:o,error:a.products}),e.jsx(d,{controlTitle:"Services",controlPlaceholder:"Enter services",controlName:"services",register:n,changeHandler:o,error:a.services}),e.jsx(W,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:n,changeHandler:o,error:a.short_description,setValue:k,getValues:F,watch:M}),e.jsx(W,{controlTitle:"Long Description",controlPlaceholder:"Long description",controlName:"long_description",register:n,changeHandler:o,error:a.long_description,setValue:k,getValues:F,watch:M}),e.jsx(d,{controlTitle:"Twitter",controlPlaceholder:"@handle",controlName:"xsocial",register:n,changeHandler:o,error:a.address}),e.jsx(d,{controlTitle:"Facebook",controlPlaceholder:"@handle",controlName:"fbsocial",register:n,changeHandler:o,error:a.fbsocial}),e.jsx(d,{controlTitle:"LinkedIn",controlPlaceholder:"https://linkedin.com/company/username",controlName:"linksocial",register:n,changeHandler:o,error:a.linksocial}),e.jsx(d,{controlTitle:"Website",controlPlaceholder:"Enter website",controlName:"website",register:n,changeHandler:o,error:a.website}),e.jsx(O,{working:y})]})})]})},_e=()=>{const s=D(),i=s.guid,u=s.userProfileData,h=u.user_guid;return e.jsxs(Y,{title:"Edit Business",children:[i&&h&&e.jsx(J,{guid:i,userGuid:h}),s&&e.jsx(se,{loaderData:s,userProfileData:u})]})};export{_e as default};
